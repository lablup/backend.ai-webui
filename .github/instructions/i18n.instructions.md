---
applyTo: "resources/i18n/**/*.json,packages/backend.ai-ui/src/locale/**/*.json,**/*.tsx,**/*.ts"
---

# Internationalization (i18n) Guidelines

These instructions ensure proper internationalization practices across the Backend.AI WebUI codebase.

## Always Use i18n Functions

### Never Hard-Code User-Facing Text
- **All user-facing text must use i18n functions**
- Never hard-code strings in English or any other language
- This includes: labels, messages, tooltips, error messages, notifications

```typescript
// ❌ Bad: Hard-coded text
<Button>Submit</Button>
<span>Loading data...</span>

// ✅ Good: Using i18n
<Button>{t('button.submit')}</Button>
<span>{t('message.loadingData')}</span>
```

## Translation Functions by Framework

### React Components (`/react`)
Use React i18n hooks and functions:

```typescript
import { useTranslation } from 'react-i18next';

const MyComponent = () => {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t('title.myPage')}</h1>
      <Button>{t('button.save')}</Button>
    </div>
  );
};
```

### Lit-Element Components (`/src`)
Use `lit-translate` functions:

```typescript
import { translate as _t, get as _text } from 'lit-translate';

render() {
  return html`
    <h1>${_t('summary.title')}</h1>
    <mwc-button label="${_text('button.submit')}"></mwc-button>
  `;
}

// In TypeScript code
const message = _text('error.connectionFailed');
```

## Translation Key Structures

### Main WebUI (`/resources/i18n/`)
Use dot-notation for hierarchical organization:

```json
{
  "button.submit": "Submit",
  "button.cancel": "Cancel",
  "error.network.timeout": "Network timeout occurred",
  "message.success.saved": "Successfully saved"
}
```

### Backend.AI UI Package (`/packages/backend.ai-ui/src/locale/`)
Use component-scoped naming with `comp:` prefix:

```json
{
  "comp:BAIPropertyFilter": {
    "PlaceHolder": "Search",
    "ResetFilter": "Reset filters"
  },
  "comp:FileExplorer": {
    "UploadFiles": "Upload Files",
    "CreateANewFolder": "Create a new folder",
    "DeleteSelectedItemDesc": "Deleted files and folders cannot be restored."
  },
  "general": {
    "NSelected": "{{count}} selected",
    "button": {
      "Cancel": "Cancel",
      "Delete": "Delete"
    }
  }
}
```

#### Usage in Components
```typescript
// Component: BAIPropertyFilter.tsx
import { useTranslation } from 'react-i18next';

const BAIPropertyFilter = () => {
  const { t } = useTranslation();

  return (
    <Input placeholder={t('comp:BAIPropertyFilter.PlaceHolder')} />
    <Button>{t('comp:BAIPropertyFilter.ResetFilter')}</Button>
  );
};
```

## Translation Guidelines

Refer to `/i18n-translation-instruction.md` for comprehensive translation guidelines, including:

### Key Principles
1. **Context Awareness**: Consider UI/UX context and maintain consistency
2. **Placeholder Preservation**: Always preserve placeholders exactly (e.g., `{{count}}`, `{{name}}`, `{{variable}}`)
3. **Conciseness**: Keep translations concise and appropriate for UI elements
4. **Professional Tone**: Maintain professional and user-friendly tone
5. **Technical Terms**: Handle technical terms appropriately
6. **Backend.AI Context**: Translations should be contextually aware of:
   - GPU virtualization, container orchestration, resource management
   - Multi-tenancy, domains, sessions, workspaces
   - Virtual folders (vfolders), mounts, sharing
   - Kernels, images, agents, scaling rules
   - UI Components: cards, pagination, forms, dialogs, notifications

### Language-Specific Guidelines

#### Korean (ko)
- Use appropriate honorifics (존댓말)
- Maintain consistency between 합니다체 and 해요체
- Keep widely-used English technical terms when appropriate

#### Japanese (ja)
- Use appropriate politeness levels (敬語)
- Consider hiragana, katakana, and kanji usage
- Keep commonly used English loanwords in katakana

#### Chinese (zh-CN / zh-TW)
- Be aware of simplified vs traditional character differences
- Consider regional vocabulary differences
- Maintain appropriate formality levels

## Naming Conventions

### Key Casing Rules

Translation keys follow strict casing rules based on their value type:

- **Keys whose value is a string** (leaf keys) → **start with Uppercase** (PascalCase)
- **Keys whose value is an object** (namespace/group keys) → **start with lowercase** (camelCase)

```json
// ✅ Good: Correct casing based on value type
{
  "example": {            // lowercase: value is an object { Title: "..." }
    "Title": "Example",   // Uppercase: value is a string
    "Description": "..."  // Uppercase: value is a string
  },
  "general": {            // lowercase: value is an object
    "NSelected": "{{count}} selected",  // Uppercase: value is a string
    "button": {           // lowercase: value is an object { Cancel: "...", Delete: "..." }
      "Cancel": "Cancel", // Uppercase: value is a string
      "Delete": "Delete"  // Uppercase: value is a string
    }
  }
}

// ❌ Bad: Incorrect casing
{
  "Example": {            // ❌ Object value should start with lowercase
    "title": "Example"    // ❌ String value should start with Uppercase
  },
  "General": {            // ❌ Object value should start with lowercase
    "nSelected": "..."    // ❌ String value should start with Uppercase
  }
}
```

**Note:** The `comp:` prefix for component namespaces (e.g., `comp:BAIModal`) follows a special convention where the component name after `comp:` uses PascalCase to match the component name.

### Main WebUI Keys
```
category.subcategory.key
```

Common categories:
- `button.*` - Button labels
- `label.*` - Form labels and field names
- `message.*` - General messages
- `error.*` - Error messages
- `dialog.*` - Dialog titles and content
- `tooltip.*` - Tooltip text
- `placeholder.*` - Input placeholders
- `title.*` - Page and section titles

### Backend.AI UI Package Keys
```
comp:<ComponentName>.<key>
```

Structure:
- `comp:<ComponentName>.*` - Component-specific translations
- `general.*` - Shared general translations
- `error.*` - Shared error messages

Examples:
```json
{
  "comp:BAIModal": {
    "ConfirmTitle": "Confirmation",
    "Cancel": "Cancel"
  },
  "comp:BAITable": {
    "SearchTableColumn": "Search table columns",
    "SelectColumnToDisplay": "Select columns to display"
  },
  "general": {
    "NSelected": "{{count}} selected",
    "TotalItems": "Total {{total}} items"
  }
}
```

## Variables and Placeholders

### Preserve Placeholder Format
Always maintain the exact placeholder format:

```typescript
// ✅ Good: Preserving placeholders
t('message.welcome', { username: user.name })
// Translation: "Welcome, {{username}}!"

t('comp:FileExplorer.DownloadStarted', { fileName: file.name })
// Translation: "File \"{{fileName}}\" download has started."

t('general.NSelected', { count: selectedItems.length })
// Translation: "{{count}} selected"
```

### Common Placeholder Formats
- React/Modern: `{{variable}}`, `{variable}`
- Legacy: `{0}`, `{1}`, `%s`, `%d`

## Code Review Checklist

When reviewing code for i18n, check for:
- [ ] No hard-coded user-facing text in any language
- [ ] All labels, messages, errors use i18n functions
- [ ] Translation keys follow naming conventions:
  - `category.key` for main WebUI
  - `comp:ComponentName.key` for backend.ai-ui package
- [ ] Key casing follows value type: Uppercase for string values, lowercase for object values
- [ ] Placeholders are preserved correctly (e.g., `{{count}}`, `{{name}}`)
- [ ] Context is appropriate for Backend.AI platform
- [ ] Technical terms are handled consistently
- [ ] Translations are concise and UI-appropriate
- [ ] No concatenated translated strings (use placeholders instead)
- [ ] Component-specific translations use `comp:` prefix in backend.ai-ui package

## Common Mistakes to Avoid

### String Concatenation
```typescript
// ❌ Bad: Concatenating translated strings
const message = t('hello') + ' ' + username + '!';

// ✅ Good: Use placeholders
const message = t('greeting.hello', { username });
```

### Wrong Key Format in backend.ai-ui Package
```typescript
// ❌ Bad: Missing comp: prefix
t('BAIModal.ConfirmTitle')

// ✅ Good: Use comp: prefix
t('comp:BAIModal.ConfirmTitle')
```

### Conditional Text
```typescript
// ❌ Bad: Hard-coded conditional text
const status = isActive ? 'Active' : 'Inactive';

// ✅ Good: Translate both states
const status = isActive ? t('status.active') : t('status.inactive');
```

### Plural Forms
```typescript
// ❌ Bad: Manual plural handling
const text = count === 1 ? '1 item' : `${count} items`;

// ✅ Good: Use i18n plural support with placeholders
const text = t('general.NSelected', { count });
// Translation supports: "{{count}} selected"
```

## Adding New Translations

### Main WebUI (`/resources/i18n/`)
1. Add translation keys to JSON files in `/resources/i18n/`
2. Provide translations for all supported languages
3. Use the translation key in component code
4. Run `make i18n` to extract and validate translation strings

### Backend.AI UI Package (`/packages/backend.ai-ui/src/locale/`)
1. Add translation keys to JSON files (e.g., `en.json`, `ko.json`)
2. Use `comp:<ComponentName>` as the top-level key for component-specific translations
3. Use `general` or `error` for shared translations
4. Ensure all supported languages have corresponding translations

### Supported Languages
- `en` - English (default)
- `ko` - Korean
- `ja` - Japanese
- `zh-CN` - Chinese (Simplified)
- `zh-TW` - Chinese (Traditional)
- And others as configured

## Testing Translations

- Test UI in all supported languages
- Verify placeholder substitution works correctly
- Check for text overflow in different languages
- Ensure proper alignment and layout with longer translations
- Test that `comp:` prefix works correctly in backend.ai-ui components
