(function(shared,scope,testing){var disassociate=function(effect){effect._animation=void 0;if(effect instanceof window.SequenceEffect||effect instanceof window.GroupEffect){for(var i=0;i<effect.children.length;i++){disassociate(effect.children[i])}}};scope.removeMulti=function(effects){for(var oldParents=[],i=0,effect;i<effects.length;i++){effect=effects[i];if(effect._parent){if(-1==oldParents.indexOf(effect._parent)){oldParents.push(effect._parent)}effect._parent.children.splice(effect._parent.children.indexOf(effect),1);effect._parent=null;disassociate(effect)}else if(effect._animation&&effect._animation.effect==effect){effect._animation.cancel();effect._animation.effect=new KeyframeEffect(null,[]);if(effect._animation._callback){effect._animation._callback._animation=null}effect._animation._rebuildUnderlyingAnimation();disassociate(effect)}}for(i=0;i<oldParents.length;i++){oldParents[i]._rebuild()}};function KeyframeList(effectInput){this._frames=shared.normalizeKeyframes(effectInput)}scope.KeyframeEffect=function(target,effectInput,timingInput,id){this.target=target;this._parent=null;timingInput=shared.numericTimingToObject(timingInput);this._timingInput=shared.cloneTimingInput(timingInput);this._timing=shared.normalizeTimingInput(timingInput);this.timing=shared.makeTiming(timingInput,!1,this);this.timing._effect=this;if("function"==typeof effectInput){shared.deprecated("Custom KeyframeEffect","2015-06-22","Use KeyframeEffect.onsample instead.");this._normalizedKeyframes=effectInput}else{this._normalizedKeyframes=new KeyframeList(effectInput)}this._keyframes=effectInput;this.activeDuration=shared.calculateActiveDuration(this._timing);this._id=id;return this};scope.KeyframeEffect.prototype={getFrames:function(){if("function"==typeof this._normalizedKeyframes)return this._normalizedKeyframes;return this._normalizedKeyframes._frames},set onsample(callback){if("function"==typeof this.getFrames()){throw new Error("Setting onsample on custom effect KeyframeEffect is not supported.")}this._onsample=callback;if(this._animation){this._animation._rebuildUnderlyingAnimation()}},get parent(){return this._parent},clone:function(){if("function"==typeof this.getFrames()){throw new Error("Cloning custom effects is not supported.")}var clone=new KeyframeEffect(this.target,[],shared.cloneTimingInput(this._timingInput),this._id);clone._normalizedKeyframes=this._normalizedKeyframes;clone._keyframes=this._keyframes;return clone},remove:function(){scope.removeMulti([this])}};var originalElementAnimate=Element.prototype.animate;Element.prototype.animate=function(effectInput,options){var id="";if(options&&options.id){id=options.id}return scope.timeline._play(new scope.KeyframeEffect(this,effectInput,options,id))};var nullTarget=document.createElementNS("http://www.w3.org/1999/xhtml","div");scope.newUnderlyingAnimationForKeyframeEffect=function(keyframeEffect){if(keyframeEffect){var target=keyframeEffect.target||nullTarget,keyframes=keyframeEffect._keyframes;if("function"==typeof keyframes){keyframes=[]}var options=keyframeEffect._timingInput;options.id=keyframeEffect._id}else{var target=nullTarget,keyframes=[],options=0}return originalElementAnimate.apply(target,[keyframes,options])};scope.bindAnimationForKeyframeEffect=function(animation){if(animation.effect&&"function"==typeof animation.effect._normalizedKeyframes){scope.bindAnimationForCustomEffect(animation)}};var pendingGroups=[];scope.awaitStartTime=function(groupAnimation){if(null!==groupAnimation.startTime||!groupAnimation._isGroup)return;if(0==pendingGroups.length){requestAnimationFrame(updatePendingGroups)}pendingGroups.push(groupAnimation)};function updatePendingGroups(){var updated=!1;while(pendingGroups.length){var group=pendingGroups.shift();group._updateChildren();updated=!0}return updated}var originalGetComputedStyle=window.getComputedStyle;Object.defineProperty(window,"getComputedStyle",{configurable:!0,enumerable:!0,value:function(){scope.timeline._updateAnimationsPromises();var result=originalGetComputedStyle.apply(this,arguments);if(updatePendingGroups())result=originalGetComputedStyle.apply(this,arguments);scope.timeline._updateAnimationsPromises();return result}});window.KeyframeEffect=scope.KeyframeEffect;window.Element.prototype.getAnimations=function(){return document.timeline.getAnimations().filter(function(animation){return null!==animation.effect&&animation.effect.target==this}.bind(this))}})(webAnimationsShared,webAnimationsNext,webAnimationsTesting);